version: 1
# Top-level frontend section for global setup and cache
frontend:
  phases:
    preBuild:
      commands:
        - echo "Installing root dependencies..."
        - npm ci # Install root dependencies based on lock file
  cache:
    paths:
      - node_modules/**/* # Cache root node_modules (relative to root)
      - packages/shared-types/dist/**/* # Cache shared-types build output (relative to root)

# Define the applications within the monorepo
applications:
  - # Configuration for the frontend application
    appRoot: frontend # The directory for this app
    frontend:
      buildPath: '/' # Run install and build from the monorepo project root
      phases:
        preBuild:
          commands:
            - echo "Installing root dependencies..."
            - npm ci # Install root dependencies based on lock file
        build:
          commands:
            - echo "Building shared-types workspace..."
            - npm run build -w @usuaya/shared-types # Build shared types first
            - echo "Building frontend workspace..."
            - npm run build -w frontend
      artifacts:
        # IMPORTANT: Path relative to the project root (because of buildPath: '/')
        baseDirectory: frontend/.next 
        files:
          - '**/*'
      cache:
        paths:
          # Paths relative to the project root
          - node_modules/**/* 
          - packages/shared-types/dist/**/* 